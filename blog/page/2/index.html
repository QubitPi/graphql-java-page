<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/graphql-java-page/blog/rss.xml" title="GraphQL Java RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/graphql-java-page/blog/atom.xml" title="GraphQL Java Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-126627606-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Blog | GraphQL Java</title><meta data-react-helmet="true" property="og:title" content="Blog | GraphQL Java"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="description" content="Blog"><meta data-react-helmet="true" property="og:description" content="Blog"><meta data-react-helmet="true" property="og:url" content="https://QubitPi.github.io//graphql-java-page/blog/page/2"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_posts_list"><link data-react-helmet="true" rel="shortcut icon" href="/graphql-java-page/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://QubitPi.github.io//graphql-java-page/blog/page/2"><link data-react-helmet="true" rel="alternate" href="https://QubitPi.github.io//graphql-java-page/blog/page/2" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://QubitPi.github.io//graphql-java-page/blog/page/2" hreflang="x-default"><link rel="stylesheet" href="/graphql-java-page/assets/css/styles.cf0d1b68.css">
<link rel="preload" href="/graphql-java-page/assets/js/runtime~main.d870872c.js" as="script">
<link rel="preload" href="/graphql-java-page/assets/js/main.f7b2d60a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/graphql-java-page/"><div class="navbar__logo"><img src="/graphql-java-page/img/logo.png" alt="GraphQL Java logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/graphql-java-page/img/logo.png" alt="GraphQL Java logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">GraphQL Java</b></a><a class="navbar__item navbar__link" href="/graphql-java-page/documentation/getting-started">Documentation</a><a href="https://leanpub.com/graphql-java/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Book</a><a class="navbar__item navbar__link" href="/graphql-java-page/tutorials/getting-started-with-spring-boot">Tutorial</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/graphql-java-page/blog">Blog</a><a class="navbar__item navbar__link" href="/graphql-java-page/about">About</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/graphql-java-page/documentation/getting-started">v20</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/graphql-java-page/documentation/master/getting-started">master</a></li><li><a class="dropdown__link" href="/graphql-java-page/documentation/getting-started">v20</a></li><li><a class="dropdown__link" href="/graphql-java-page/documentation/v19/getting-started">v19</a></li></ul></div><a href="https://github.com/graphql-java/graphql-java" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9"></span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9"></span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-list-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_q+wC thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_9G5K margin-bottom--md">All posts</div><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/graphql-java-page/blog/release-policy">GraphQL Java release policy</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/graphql-java-page/blog/java-11-required">GraphQL Java will require Java 11</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/graphql-java-page/blog/version-20-released">Version 20 released</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/graphql-java-page/blog/spring-for-graphql">Spring for GraphQL is the recommended Spring integration</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/graphql-java-page/blog/17-released-and-lts">GraphQL Java 17 released and an update about LTS</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/graphql-java-page/blog/spec-releases-are-not-important">GraphQL spec releases are not important</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/graphql-java-page/blog/threads">GraphQL Java and Threads</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/graphql-java-page/blog/deep-dive-data-fetcher-results">Building efficient data fetchers by looking ahead</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/graphql-java-page/blog/deep-dive-merged-fields">GraphQL Deep Dive Part 1 - merged fields</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/graphql-java-page/blog/graphql-java-spring-support">First release of GraphQL Java Spring</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/graphql-java-page/blog/introducing-extended-scalars">Introducing graphql-java-extended-scalars</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/graphql-java-page/blog/graphql-java-aims-to-be-used-directly">GraphQL Java aims to be used directly</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/graphql-java-page/blog/breaking-changes-and-lts">About breaking changes and Long-term support</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/graphql-java-page/blog/spectrum-and-new-doc">Moving to spectrum and new documentation home</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/graphql-java-page/blog/moving-projects">Moving projects out of the GraphQL Java org</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/graphql-java-page/blog/welcome-to-graphql-java">Welcome to the new GraphQL Java homepage</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/graphql-java-page/blog/spec-releases-are-not-important">GraphQL spec releases are not important</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2021-02-12T00:00:00.000Z" itemprop="datePublished">February 12, 2021</time> 路 <!-- -->2 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/andimarek" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/andimarek.png" alt="Andreas Marek"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/andimarek" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Andreas Marek</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of GraphQL Java</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Every once in a while somebody asks which version of the <a href="https://github.com/graphql/graphql-spec" target="_blank" rel="noopener noreferrer">GraphQL spec</a>
GraphQL Java supports. The general answer is: the current draft.</p><p>The bigger question behind this is: what is the information you want get out of this question?
Why do you ask this question?</p><p>The thing is: spec releases are not really important and people misinterpret what they mean.</p><header><h1>Evolution of the spec process</h1></header><p>The GraphQL spec has five releases so far:</p><ul><li>two in 2015 (including the first published version)</li><li>two in 2016</li><li>one in 2018</li></ul><p>As you can see in the first two years spec releases where quite frequently, but after the one in 2018,
there has not been a release.</p><p>2017 was also the year the <a href="https://github.com/graphql/graphql-wg" target="_blank" rel="noopener noreferrer">GraphQL Working Group</a> was established.
This group is the main forum to evolve the spec since then. Over time this group established a very high bar
for every PR to be merged into the spec. (See the <a href="https://github.com/graphql/graphql-spec/blob/main/CONTRIBUTING.md" target="_blank" rel="noopener noreferrer">Contributing guidelines</a>)</p><p>With this high standard set, nearly all implementations (including GraphQL Java) started to implement every
merged PR instead of waiting for a big release. Because they are very confident this change will be released
in this form, it is safe to implement it right away.</p><p>This treatment of merged PRs as de-factor releases is now an established rule in the GraphQL community.
This explains why the whole GraphQL ecosystem has evolved a lot since 2018, even without a release.</p><p><strong>A release is not needed anymore if every merged PR is like a mini release.</strong></p><p>Future releases are more like an
<a href="https://github.com/graphql/graphql-wg/blob/main/notes/2021-02-04.md#promoting-and-documenting-spec-release-5m-brian" target="_blank" rel="noopener noreferrer">opportunity to look back and promote the work since the last release.</a></p><p>I personally hope that we make this de-facto rule, that evey PR is a mini release, more official.
We should not use the word &quot;draft&quot; any more, but every merged PR should automatically result in a
new GraphQL spec version which is formally approved by the <a href="https://github.com/graphql/graphql-wg/blob/main/GraphQL-TSC.md" target="_blank" rel="noopener noreferrer">GraphQL TSC.</a></p><p>Coming back to the question: &quot;Which spec version of GraphQL is supported&quot;?
I hope by now it is clear why this question is probably not really helpful.</p><p>It is better to think about certain features you want to discuss instead referring to the spec releases.</p><header><h1>Feedback or questions</h1></header><p>We use <a href="https://github.com/graphql-java/graphql-java/discussions" target="_blank" rel="noopener noreferrer">GitHub Discussions</a> for general feedback and questions.</p><p>You can also contact us on Twitter: <a href="https://twitter.com/graphql_java" target="_blank" rel="noopener noreferrer">@graphql_java</a></p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/graphql-java-page/blog/threads">GraphQL Java and Threads</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2021-02-05T00:00:00.000Z" itemprop="datePublished">February 5, 2021</time> 路 <!-- -->4 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/andimarek" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/andimarek.png" alt="Andreas Marek"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/andimarek" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Andreas Marek</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of GraphQL Java</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>We follow a fundamental rule in GraphQL Java regarding Threads: GraphQL Java never creates
Threads or interacts with Thread pools. We do this because we want to give the user the full control
and whatever GraphQL Java would do, it would not be correct for every use case.</p><p>Additionally to being strictly unopinionated regarding Threads, GraphQL Java is also fully reactive,
implemented via <code>CompletableFuture</code> (<code>CF</code>).
These two constrain together mean we rely on the <code>CF</code> returned by the user.
Specifically we piggyback on the <code>CF</code> returned by the <code>DataFetcher</code>
(or other async methods which can be implemented by the user, but we focus here on <code>DataFetcher</code>
as it is by far the most important).</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">// Pseudo code in GraphQL Java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CompletableFuture&lt;Object&gt; dataFetcherResult = invokeDataFetcher();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dataFetcherResult.thenApply(result -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // in which Thread  where this code happens is controlled by the CF returned</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    continueExecutingQuery(result);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><header><h1>Blocking DataFetcher</h1></header><p>Lets assume you are accessing a DB in a blocking way in your <code>DataFetcher</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">String get(DataFetchingEnvironment env) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return getValueFromDb(env); // blocking the Thread until the value is read from DB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This is not completely wrong, but not recommend in general as the consequence of this kind of <code>DataFecher</code>
is that GraphQL can&#x27;t execute the query in the most efficient way.</p><p>For example for the following query:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dbData1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dbData2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dbData3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>If the <code>DataFetcher</code> for these <code>dbData</code> fields don&#x27;t return a <code>CF</code>,
but block the Thread until the data is read, GraphQL Java will not work with maximum efficiency.</p><p>GraphQL Java can invoke the <code>DataFetcher</code> for all three fields in parallel. But if your <code>DataFetcher</code> for
<code>dbData1</code> is blocking, GraphQL Java will also be blocked and only invoke the next <code>DataFetcher</code> once <code>dbData&lt;n&gt;</code>
is finished.
The recommend solution to this problem is offloading your blocking code onto a separate Thread pool
as shown here:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">CompletableFuture&lt;String&gt; get(DataFetchingEnvironment env) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return CompletableFuture.supplyAsync( getValueFromDb(env), dbThreadPool );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This code will maximize the performance and will cause all three fields to be fetched in parallel.</p><header><h1>Different pools for different work</h1></header><p>The subsequent work done by GraphQL Java will be executed in the same <code>dbThreadPool</code> until it
encounters a new <code>DataFetcher</code> returned by the user code and this new <code>CF</code> dedicates the Thread
for the subsequent work.</p><p>If you want to have separate pools for different kind of work, one for the actual <code>DataFetcher</code> which normally
involve IO and one of the actual GraphQL Java work (which is pure CPU), you need to switch back from your offloaded
pool to a dedicated GraphQL Java pool before returning the <code>CF</code>. You can achieve this with code like this:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">CompletableFuture&lt;String&gt; get(DataFetchingEnvironment env) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return CompletableFuture.supplyAsync( getValueFromDb(env), dbThreadPool )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .handleAsync((result,exception) -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if(exception !=null) throw exception;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }, graphqlJavaPool);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Notice the <code>.handleAsync</code> which doesn&#x27;t do anything except forwarding the result, but on a
different pool (<code>graphqlJavaPool</code>).</p><p>This way you have different pools for different kind of work (one for CPU bound GraphQL Java work and one
for multiple ones for IO bound work), which can be configured and monitored independently.</p><header><h1>In a fully reactive system</h1></header><p>If your system is fully reactive your <code>DataFetcher</code> will more look like this</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">CompletableFuture&lt;String&gt; get(DataFetchingEnvironment env) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return callAnotherServiceNonBlocking(env); // returns CompletableFuture</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The code above could be implemented via <a href="https://github.com/AsyncHttpClient/async-http-client" target="_blank" rel="noopener noreferrer">Async Http Client</a>
or <a href="https://docs.spring.io/spring-framework/docs/current/reference/html/web-reactive.html#webflux-client" target="_blank" rel="noopener noreferrer">WebFlux WebClient</a>.
Both provide fully reactive HTTP clients.</p><p>Because the code is non blocking there is no need to offload anything on a dedicated Thread pool to avoid blocking
GraphQL Java.</p><p>You still might want to consider using a dedicated GraphQL Java pool as you otherwise would use
Threads which are dedicated to IO. How much this is really relevant depends highly on your use case.</p><p>For example <code>Async Http Client</code> (<code>AHC</code>) uses by default 2 * #cores (this value comes actually from Netty) Threads. If you
don&#x27;t use a dedicated Thread Pool for GraphQL Java you might encounter situations under load where all <code>AHC</code>
Threads are either busy or blocked by GraphQL Java code and as a result your system is not as performant as it
could be. Normally only load tests in production like environments can show the relevance of different Thread pools.</p><header><h1>Feedback or questions</h1></header><p>We use <a href="https://github.com/graphql-java/graphql-java/discussions" target="_blank" rel="noopener noreferrer">GitHub Discussions</a> for general feedback and questions.</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/graphql-java-page/blog/deep-dive-data-fetcher-results">Building efficient data fetchers by looking ahead</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2019-04-11T00:00:00.000Z" itemprop="datePublished">April 11, 2019</time> 路 <!-- -->5 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/bbakerman" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/bbakerman.png" alt="Brad Baker"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/bbakerman" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Brad Baker</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of GraphQL Java</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Today we are looking into the <code>graphql.schema.DataFetchingFieldSelectionSet</code> and <code>graphql.execution.DataFetcherResult</code> objects as means
to build efficient data fetchers.</p><header><h1>The scenario</h1></header><p>But first lets set the scene. Imagine we have a system that can return <code>issues</code> and the <code>comments</code> on those <code>issues</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  issues </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    summary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    comments </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Nominally we would have a <code>graphql.schema.DataFetcher</code> on <code>issues</code> that returns a list of issues and one on the field <code>comments</code> that returns the list of comments
for each issue <code>source</code> object.</p><p>As you can see this naively creates an <em>N+1 problem</em> where we need to fetch data multiple times, one for each <code>issue</code> object in isolation.</p><p>We could attack this using the <code>org.dataloader.DataLoader</code> pattern but there is another way which will discuss in this article.</p><header><h1>Look ahead via DataFetchingFieldSelectionSet</h1></header><p>The data fetcher behind the <code>issues</code> field is able to look ahead and see what sub fields are being asked for.  In this case it knows that <code>comments</code> are being asked
for and hence it could prefetch them at the same time.</p><p><code>graphql.schema.DataFetchingEnvironment#getSelectionSet</code> (aka <code>graphql.schema.DataFetchingFieldSelectionSet</code>) can be used by data fetcher code to get the selection set of fields for a given parent field.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">DataFetcher issueDataFetcher = environment -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DataFetchingFieldSelectionSet selectionSet = environment.getSelectionSet();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (selectionSet.contains(&quot;comments&quot;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;IssueAndCommentsDTO&gt; data = getAllIssuesWithComments(environment, selectionSet.getFields());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;IssueDTO&gt; issues = getAllIssuesWitNoComments(environment);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return issues;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Imagine this is backed by an SQL system we might be able to use this field look ahead to produce the following SQL</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sql"><pre tabindex="0" class="prism-code language-sql codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> Issues</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">Key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Issues</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Summary</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Comments</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">Text</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> Issues</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INNER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">JOIN</span><span class="token plain"> Comments </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> Issues</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CommentID</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Comments</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>So we have looked ahead and returned different data depending on the field sub selection.  We have made our system more efficient by using look ahead
to fetch data just the <code>1</code> time and not <code>N+1</code> times.</p><header><h1>Code Challenges</h1></header><p>The challenge with this code design is that the shapes of the returned data is now field sub selection specific.  We needed a <code>IssueAndCommentsDTO</code> for one sub selection
path and a simpler <code>IssueDTO</code> for another path.</p><p>With enough paths this becomes problematic as it adds new DTO classes per path and makes out child data fetchers more complex</p><p>Also the standard graphql pattern is that the returned object becomes the <code>source</code> ie. <code>graphql.schema.DataFetchingEnvironment#getSource</code> of the next child
data fetcher.  But we might have pre fetched data that is needed 2 levels deep and this is challenging to do since each data fetcher would need to capture and copy
that data down to the layers below via new TDOs classes per level.</p><header><h1>Passing Data and Local Context</h1></header><p>GraphQL Java offers a capability that helps with this pattern.  GraphQL Java goes beyond what the reference graphql-js system gives you where the object you
returned is automatically the <code>source</code> of the next child fetcher and that&#x27;s all it can be.</p><p>In GraphQL Java you can use well known <code>graphql.execution.DataFetcherResult</code> to return three sets of values</p><ul><li><code>data</code>  - which will be used as the source on the next set of sub fields</li><li><code>errors</code> - allowing you to return data as well as errors</li><li><code>localContext</code> - which allows you to pass down field specific context</li></ul><p>When the engine sees the <code>graphql.execution.DataFetcherResult</code> object, it automatically unpacks it and handles it three classes of data in specific ways.</p><p>In our example case we will be use <code>data</code> and <code>localContext</code> to communicate between fields easily.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">DataFetcher issueDataFetcher = environment -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DataFetchingFieldSelectionSet selectionSet = environment.getSelectionSet();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (selectionSet.contains(&quot;comments&quot;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;IssueAndCommentsDTO&gt; data = getAllIssuesWithComments(environment, selectionSet.getFields());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;IssueDTO&gt; issues = data.stream().map(dto -&gt; dto.getIssue()).collect(toList());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;IssueDTO, List&lt;CommentDTO&gt;&gt; preFetchedComments = mkMapOfComments(data);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return DataFetcherResult.newResult()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .data(issues)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .localContext(preFetchedComments)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;IssueDTO&gt; issues = getAllIssuesWitNoComments(environment);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return DataFetcherResult.newResult()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .data(issues)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>If you look now you will see that our data fetcher returns a <code>DataFetcherResult</code> object that contains <code>data</code> for the child data fetchers which is the
list of <code>issueDTO</code> objects as per usual.  It will be their <code>source</code> object when they run.</p><p>It also passes down field specific <code>localContext</code> which is the pre-fetched comment data.</p><p>Unlike the global context object, local context objects are passed down from a specific field to its children and are not shared across to peer fields.  This means
a parent field has a &quot;back channel&quot; to talk to the child fields without having to &quot;pollute&quot; the DTO source objects with that information and it is &quot;local&quot; in the sense
that it given only to this field and its children and not any other field in the query.</p><p>Now lets look at the <code>comments</code> data fetcher and how it consumes this back channel of data</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">DataFetcher commentsDataFetcher = environment -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IssueDTO issueDTO = environment.getSource();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Map&lt;IssueDTO, List&lt;CommentDTO&gt;&gt; preFetchedComments = environment.getLocalContext();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    List&lt;CommentDTO&gt; commentDTOS = preFetchedComments.get(issueDTO);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return DataFetcherResult.newResult()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .data(commentDTOS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .localContext(preFetchedComments)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Notice how it got the <code>issueDTO</code> as its source object as expected but it also got a local context object which is our pre-fetched comments.  It can choose
to pass on new local context OR if it passes nothing then the previous value will bubble down to the next lot of child fields.  So you can think of <code>localContext</code>
as being inherited unless a fields data fetcher explicitly overrides it.</p><p>Our data fetcher is a bit more complex because of the data pre-fetching but &#x27;localContext&#x27; allows us a nice back channel to pass data without modifying our DTO objects
that are being used in more simple data fetchers.</p><header><h1>Passing back Errors or Data or Both</h1></header><p>For completeness we will show you that you can also pass down errors or data or local context or all of them at once.</p><p>It is perfectly valid to fetch data in graphql and to ALSO send back errors.  Its not common but its valid. Some data is better than no data.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">GraphQLError error = mkSpecialError(&quot;Its Tuesday&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return DataFetcherResult.newResult()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .data(commentDTOS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .error(error)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .build();</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/graphql-java-page/blog/deep-dive-merged-fields">GraphQL Deep Dive Part 1 - merged fields</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2019-01-22T00:00:00.000Z" itemprop="datePublished">January 22, 2019</time> 路 <!-- -->4 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/andimarek" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/andimarek.png" alt="Andreas Marek"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/andimarek" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Andreas Marek</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of GraphQL Java</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Welcome to the new series &quot;GraphQL deep dive&quot; where we will explore advanced or unknown GraphQL topics. The plan is to discuss things mostly in a language and implementation neutral way, even if it is hosted on graphql-java.com.</p><header><h1>Merged Fields</h1></header><p>First thing we are looking at is &quot;merged fields&quot;.</p><p>GraphQL allows for a field to be declared multiple times in a query as long as it can be merged.</p><p>Valid GraphQL queries are:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Each of these queries will result in a result with just one &quot;foo&quot; key, not two or three.</p><p>Invalid Queries are:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;456&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">id2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">foo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> foo2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The reason why they are not valid, is because the fields are different: in the first two examples the arguments differ and the third query actually has two different fields under the same key.</p><header><h1>Motivation</h1></header><p>The examples so far don&#x27;t seem really useful, but it all makes sense when you add fragments:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">...</span><span class="token fragment function" style="color:#d73a49">myFragment1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">...</span><span class="token fragment function" style="color:#d73a49">myFragment2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fragment</span><span class="token plain"> </span><span class="token fragment function" style="color:#d73a49">myFragment1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token class-name">Query</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fragment</span><span class="token plain"> </span><span class="token fragment function" style="color:#d73a49">myFragment2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token class-name">Query</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    url</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Fragments are designed to be written by different parties (for example different components in a UI) which should not know anything about each other. Requiring that every field can only be declared once would make this objective unfeasible.</p><p>But by allowing fields merging, as long as the fields are the same, allows fragments to be authored in an independent way from each other.</p><header><h1>Rules when fields can be merged</h1></header><p>The specific details when fields can be merged are written down in <a href="https://facebook.github.io/graphql/draft/#sec-Field-Selection-Merging" target="_blank" rel="noopener noreferrer">Field Selection Merging</a> in the spec.</p><p>The rules are what you would expect in general and they basically say that fields must be the same. The following examples are taken from the spec and they are all valid:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">fragment</span><span class="token plain"> </span><span class="token fragment function" style="color:#d73a49">mergeIdenticalFields</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token class-name">Dog</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fragment</span><span class="token plain"> </span><span class="token fragment function" style="color:#d73a49">mergeIdenticalAliasesAndFields</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token class-name">Dog</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">otherName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">otherName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fragment</span><span class="token plain"> </span><span class="token fragment function" style="color:#d73a49">mergeIdenticalFieldsWithIdenticalArgs</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token class-name">Dog</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  doesKnowCommand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">dogCommand</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SIT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  doesKnowCommand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">dogCommand</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SIT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fragment</span><span class="token plain"> </span><span class="token fragment function" style="color:#d73a49">mergeIdenticalFieldsWithIdenticalValues</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token class-name">Dog</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  doesKnowCommand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">dogCommand</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$dogCommand</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  doesKnowCommand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">dogCommand</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$dogCommand</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The most complex case happens when you have fields in fragments on different types:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">fragment</span><span class="token plain"> </span><span class="token fragment function" style="color:#d73a49">safeDifferingFields</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token class-name">Pet</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token class-name">Dog</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attr-name" style="color:#00a4db">volume</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> barkVolume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token class-name">Cat</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attr-name" style="color:#00a4db">volume</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> meowVolume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This is normally invalid because <code>volume</code> is an alias for two different fields <code>barkVolume</code> and <code>meowVolume</code> but because only one of the some are actually resolved and they both return a value of the same type (we assume here that <code>barkVolume</code> and <code>meowVolume</code> are both of the same type) it is valid.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">fragment</span><span class="token plain"> </span><span class="token fragment function" style="color:#d73a49">safeDifferingArgs</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token class-name">Pet</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token class-name">Dog</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    doesKnowCommand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">dogCommand</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SIT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token class-name">Cat</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    doesKnowCommand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">catCommand</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">JUMP</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This is again a valid case because even if the first <code>doesKnowCommand</code> has a different argument than the second <code>doesKnowCommand</code> only one of them is actually resolved.</p><p>In the next example <code>someValue</code> has different types (we assume that <code>nickname</code> is a <code>String</code> and <code>meowVolume</code> is a <code>Int</code>) and therefore the query is not valid:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">fragment</span><span class="token plain"> </span><span class="token fragment function" style="color:#d73a49">conflictingDifferingResponses</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token class-name">Pet</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token class-name">Dog</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attr-name" style="color:#00a4db">someValue</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nickname</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token class-name">Cat</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attr-name" style="color:#00a4db">someValue</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> meowVolume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><header><h1>Sub selections and directives</h1></header><p>One thing to keep in my mind is that the sub selections of fields are merged together. For example here <code>foo</code> is resolved once and than <code>id</code> and <code>name</code> is resolved.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This query is the same as:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The second thing to keep in mind is that different directives can be on each field:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token directive function" style="color:#d73a49">@myDirective</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token directive function" style="color:#d73a49">@myOtherDirective</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>So if you want to know all directives for the current field you are resolving you actually need to look at all of the merged fields from the query.</p><header><h1>Merged fields in graphql-js and GraphQL Java</h1></header><p>In graphql-js merged fields are relevant when you implement a resolver and you need access to the specific ast field of the query. The <code>info</code> objects has a property <code>fieldNodes</code> which gives you access to all ast fields which are merged together.</p><p>In GraphQL Java depending on the version you are running you have <code>List&lt;Field&gt; getFields()</code> in the <code>DataFetcherEnvironment</code> or for GraphQL Java newer than <code>12.0</code> you have also <code>MergedField getMergedField()</code> which is the recommend way to access all merged fields.</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/graphql-java-page/blog/graphql-java-spring-support">First release of GraphQL Java Spring</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2018-12-01T00:00:00.000Z" itemprop="datePublished">December 1, 2018</time> 路 <!-- -->One min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/andimarek" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/andimarek.png" alt="Andreas Marek"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/andimarek" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Andreas Marek</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of GraphQL Java</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p><strong><a href="https://spring.io/projects/spring-graphql" target="_blank" rel="noopener noreferrer">Spring for GraphQL</a> is the official and current Spring integration.</strong> The integration is a collaboration between the Spring and GraphQL Java teams, and is maintained by the Spring team. </p><p><a href="https://www.graphql-java.com/blog/spring-for-graphql" target="_blank" rel="noopener noreferrer">We recommend using Spring for GraphQL</a>, rather than the older Spring project mentioned in this blog post.</p><p>See our <a href="https://www.graphql-java.com/tutorials/getting-started-with-spring-boot" target="_blank" rel="noopener noreferrer">Spring for GraphQL</a> tutorial for how to get started.</p></div></div><p>We are happy to release the first version of the GraphQL Java Spring (Boot) project.</p><p>As <a href="https://www.graphql-java.com/blog/graphql-java-aims-to-be-used-directly/" target="_blank" rel="noopener noreferrer">described before</a> this project
complements the GraphQL Java core project if you build a fully operational GraphQL server with Spring.</p><p>Currently it supports GET and POST requests and allows for some basic customization.</p><p>In future we are looking into supporting more advanced features like file upload or subscriptions.</p><p>As always contributions are more than welcome and we are hoping to grow this project together with the
community: please open a <a href="https://github.com/graphql-java/graphql-java-spring/issues/new" target="_blank" rel="noopener noreferrer">new issue</a> or leave a comment on <a href="https://spectrum.chat/graphql-java" target="_blank" rel="noopener noreferrer">spectrum chat</a> about your wishes.</p><p>More details on how to use it can be found on the github page: <a href="https://github.com/graphql-java/graphql-java-spring" target="_blank" rel="noopener noreferrer">https://github.com/graphql-java/graphql-java-spring</a></p></div></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/graphql-java-page/blog"><div class="pagination-nav__label">芦<!-- --> <!-- -->Newer Entries</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/graphql-java-page/blog/page/3"><div class="pagination-nav__label">Older Entries<!-- --> <!-- -->禄</div></a></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/graphql-java-page/documentation/getting-started">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/graphql-java-page/tutorials/getting-started-with-spring-boot">3 Min Tutorial</a></li><li class="footer__item"><a href="https://javadoc.io/doc/com.graphql-java/graphql-java/" target="_blank" rel="noopener noreferrer" class="footer__link-item">JavaDoc</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/graphql-java/graphql-java/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/graphql_java" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/graphql-java-page/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/graphql-java/graphql-java" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright 漏 2023 Andreas Marek.</div></div></div></footer></div>
<script src="/graphql-java-page/assets/js/runtime~main.d870872c.js"></script>
<script src="/graphql-java-page/assets/js/main.f7b2d60a.js"></script>
</body>
</html>