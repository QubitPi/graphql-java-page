"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[7491],{3905:function(e,a,t){t.d(a,{Zo:function(){return c},kt:function(){return h}});var n=t(7294);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function i(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function l(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?i(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function o(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)t=i[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)t=i[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=n.createContext({}),s=function(e){var a=n.useContext(p),t=a;return e&&(t="function"==typeof e?e(a):l(l({},a),e)),t},c=function(e){var a=s(e.components);return n.createElement(p.Provider,{value:a},e.children)},u={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},m=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),m=s(t),h=r,d=m["".concat(p,".").concat(h)]||m[h]||u[h]||i;return t?n.createElement(d,l(l({ref:a},c),{},{components:t})):n.createElement(d,l({ref:a},c))}));function h(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var i=t.length,l=new Array(i);l[0]=m;var o={};for(var p in a)hasOwnProperty.call(a,p)&&(o[p]=a[p]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var s=2;s<i;s++)l[s]=t[s];return n.createElement.apply(null,l)}return n.createElement.apply(null,t)}m.displayName="MDXCreateElement"},226:function(e,a,t){t.r(a),t.d(a,{contentTitle:function(){return p},default:function(){return m},frontMatter:function(){return o},metadata:function(){return s},toc:function(){return c}});var n=t(7462),r=t(3366),i=(t(7294),t(3905)),l=["components"],o={title:"Scalars",date:new Date("2024-01-11T00:00:00.000Z"),description:"How scalar types work in graphql and how to write your own scalars"},p="Scalars in GraphQL",s={unversionedId:"scalars",id:"version-v21/scalars",isDocsHomePage:!1,title:"Scalars",description:"How scalar types work in graphql and how to write your own scalars",source:"@site/versioned_docs/version-v21/scalars.md",sourceDirName:".",slug:"/scalars",permalink:"/graphql-java-page/documentation/v21/scalars",editUrl:"https://github.com/graphql-java/graphql-java-page/edit/master/versioned_docs/version-v21/scalars.md",tags:[],version:"v21",frontMatter:{title:"Scalars",date:"2024-01-11T00:00:00.000Z",description:"How scalar types work in graphql and how to write your own scalars"},sidebar:"version-v21/tutorialSidebar",previous:{title:"Relay",permalink:"/graphql-java-page/documentation/v21/relay"},next:{title:"Schema",permalink:"/graphql-java-page/documentation/v21/schema"}},c=[{value:"Scalars",id:"scalars",children:[],level:2},{value:"Writing your own Custom Scalars",id:"writing-your-own-custom-scalars",children:[],level:2},{value:"Coercing values",id:"coercing-values",children:[],level:2},{value:"Validation of input and output",id:"validation-of-input-and-output",children:[],level:2},{value:"Example implementation",id:"example-implementation",children:[],level:2}],u={toc:c};function m(e){var a=e.components,t=(0,r.Z)(e,l);return(0,i.kt)("wrapper",(0,n.Z)({},u,t,{components:a,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"scalars-in-graphql"},"Scalars in GraphQL"),(0,i.kt)("h2",{id:"scalars"},"Scalars"),(0,i.kt)("p",null,"The leaf nodes of the GraphQL type system are called scalars. Once you reach a scalar type, you\ncannot descend any further into the type hierarchy. A scalar type is meant to represent\nan indivisible value."),(0,i.kt)("p",null,"The ",(0,i.kt)("a",{parentName:"p",href:"https://qubitpi.github.io/graphql-spec/draft/#sec-Scalars"},"GraphQL specification")," states that all implementations must have the following scalar types:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"String aka ",(0,i.kt)("inlineCode",{parentName:"li"},"GraphQLString")," - A UTF\u20108 character sequence."),(0,i.kt)("li",{parentName:"ul"},"Boolean aka ",(0,i.kt)("inlineCode",{parentName:"li"},"GraphQLBoolean")," - true or false."),(0,i.kt)("li",{parentName:"ul"},"Int aka ",(0,i.kt)("inlineCode",{parentName:"li"},"GraphQLInt")," - A signed 32\u2010bit integer."),(0,i.kt)("li",{parentName:"ul"},"Float aka ",(0,i.kt)("inlineCode",{parentName:"li"},"GraphQLFloat")," - A signed double-precision floating-point value."),(0,i.kt)("li",{parentName:"ul"},"ID aka ",(0,i.kt)("inlineCode",{parentName:"li"},"GraphQLID")," - A unique identifier which is serialized in the same way as a String. However, defining it as an ID signifies that it is not intended to be human\u2010readable.")),(0,i.kt)("p",null,"The class ",(0,i.kt)("inlineCode",{parentName:"p"},"graphql.Scalars")," contains singleton instances of the provided scalar types."),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/graphql-java/graphql-java-extended-scalars"},"graphql-java-extended-scalars")," adds many more scalars, including the following which are useful in Java based systems:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Long aka ",(0,i.kt)("inlineCode",{parentName:"li"},"GraphQLLong")," - a java.lang.Long based scalar"),(0,i.kt)("li",{parentName:"ul"},"Short aka ",(0,i.kt)("inlineCode",{parentName:"li"},"GraphQLShort")," - a java.lang.Short based scalar"),(0,i.kt)("li",{parentName:"ul"},"Byte aka ",(0,i.kt)("inlineCode",{parentName:"li"},"GraphQLByte"),"  - a java.lang.Byte based scalar"),(0,i.kt)("li",{parentName:"ul"},"BigDecimal aka ",(0,i.kt)("inlineCode",{parentName:"li"},"GraphQLBigDecimal")," - a java.math.BigDecimal based scalar"),(0,i.kt)("li",{parentName:"ul"},"BigInteger aka ",(0,i.kt)("inlineCode",{parentName:"li"},"GraphQLBigInteger")," - a java.math.BigInteger based scalar")),(0,i.kt)("p",null,"See the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/graphql-java/graphql-java-extended-scalars"},"documentation")," for how to use Extended Scalars."),(0,i.kt)("h2",{id:"writing-your-own-custom-scalars"},"Writing your own Custom Scalars"),(0,i.kt)("p",null,"If the scalar you want isn't in a library, you can also write your own custom scalar implementation. In doing so you take on the responsibility for coercing values\nat runtime, which we will explain in a moment."),(0,i.kt)("p",null,"Imagine we decide we need to have an email scalar type. It will take email addresses as input and output."),(0,i.kt)("p",null,"We would create a singleton ",(0,i.kt)("inlineCode",{parentName:"p"},"graphql.schema.GraphQLScalarType")," instance for this."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'public static final GraphQLScalarType EMAIL = GraphQLScalarType.newScalar()\n        .name("email")\n        .description("A custom scalar that handles emails")\n        .coercing(new Coercing() {\n            @Override\n            public Object serialize(Object dataFetcherResult, GraphQLContext graphQLContext, Locale locale) {\n                return serializeEmail(dataFetcherResult);\n            }\n\n            @Override\n            public Object parseValue(Object input, GraphQLContext graphQLContext, Locale locale) {\n                return parseEmailFromVariable(input);\n            }\n\n            @Override\n            public Object parseLiteral(Value input, CoercedVariables variables, GraphQLContext graphQLContext, Locale locale) {\n                return parseEmailFromAstLiteral(input);\n            }\n        })\n        .build();\n')),(0,i.kt)("h2",{id:"coercing-values"},"Coercing values"),(0,i.kt)("p",null,"The real work in any custom scalar implementation is the ",(0,i.kt)("inlineCode",{parentName:"p"},"graphql.schema.Coercing")," implementation. This is responsible for 3 functions:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"parseValue")," - takes a variable input object and converts into the Java runtime representation"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"parseLiteral")," - takes an AST literal ",(0,i.kt)("inlineCode",{parentName:"li"},"graphql.language.Value")," as input and converts into the Java runtime representation"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"serialize")," - takes a Java object and converts it into the output shape for that scalar")),(0,i.kt)("p",null,"So your custom scalar code has to handle 2 forms of input (",(0,i.kt)("inlineCode",{parentName:"p"},"parseValue")," / ",(0,i.kt)("inlineCode",{parentName:"p"},"parseLiteral"),") and 1 form of output (",(0,i.kt)("inlineCode",{parentName:"p"},"serialize"),")."),(0,i.kt)("p",null,"Imagine this query, which uses variables, AST literals and outputs our scalar type ",(0,i.kt)("inlineCode",{parentName:"p"},"email"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-graphql"},'mutation Contact($mainContact: Email!) {\n  makeContact(mainContactEmail: $mainContact, backupContactEmail: "backup@company.com") {\n    id\n    mainContactEmail\n  }\n}\n')),(0,i.kt)("p",null,"Our custom Email scalar will:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"be called via ",(0,i.kt)("inlineCode",{parentName:"li"},"parseValue")," to convert the ",(0,i.kt)("inlineCode",{parentName:"li"},"$mainContact")," variable value into a runtime object"),(0,i.kt)("li",{parentName:"ul"},"be called via ",(0,i.kt)("inlineCode",{parentName:"li"},"parseLiteral")," to convert the AST ",(0,i.kt)("inlineCode",{parentName:"li"},"graphql.language.StringValue"),' "',(0,i.kt)("a",{parentName:"li",href:"mailto:backup@company.com"},"backup@company.com"),'" into a runtime object'),(0,i.kt)("li",{parentName:"ul"},"be called via ",(0,i.kt)("inlineCode",{parentName:"li"},"serialize")," to turn the runtime representation of mainContactEmail into a form ready for output")),(0,i.kt)("h2",{id:"validation-of-input-and-output"},"Validation of input and output"),(0,i.kt)("p",null,"The methods can validate that the received input makes sense. For example our email scalar will try to validate that the input\nand output are indeed email addresses."),(0,i.kt)("p",null,"The JavaDoc method contract of ",(0,i.kt)("inlineCode",{parentName:"p"},"graphql.schema.Coercing")," says the following:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"The ",(0,i.kt)("inlineCode",{parentName:"p"},"serialize")," MUST ONLY allow ",(0,i.kt)("inlineCode",{parentName:"p"},"graphql.schema.CoercingSerializeException")," to be thrown from it. This indicates that the\nvalue cannot be serialized into an appropriate form.  You must not allow other runtime exceptions to escape this method to get\nthe normal graphql behaviour for validation.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"The ",(0,i.kt)("inlineCode",{parentName:"p"},"parseValue")," MUST ONLY allow ",(0,i.kt)("inlineCode",{parentName:"p"},"graphql.schema.CoercingParseValueException")," to be thrown from it. This indicates that the\nvalue cannot be parsed as input into an appropriate form. You must not allow other runtime exceptions to escape this method to get\nthe normal graphql behaviour for validation.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"The ",(0,i.kt)("inlineCode",{parentName:"p"},"parseLiteral")," MUST ONLY allow ",(0,i.kt)("inlineCode",{parentName:"p"},"graphql.schema.CoercingParseLiteralException")," to be thrown from it. This indicates that the\nAST value cannot be parsed as input into an appropriate form. You must not allow any runtime exceptions to escape this method to get\nthe normal graphql behaviour for validation."))),(0,i.kt)("p",null,"Some people try to rely on runtime exceptions for validation and hope that they come out as graphql errors. This is not the case. You\nMUST follow the ",(0,i.kt)("inlineCode",{parentName:"p"},"Coercing")," method contracts to allow the graphql-java engine to work according to the graphql specification on scalar types."),(0,i.kt)("h2",{id:"example-implementation"},"Example implementation"),(0,i.kt)("p",null,"The following is a really rough implementation of our imagined ",(0,i.kt)("inlineCode",{parentName:"p"},"email")," scalar type to show you how one might implement the ",(0,i.kt)("inlineCode",{parentName:"p"},"Coercing")," methods."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'public static class EmailScalar {\n\n    public static final GraphQLScalarType EMAIL = GraphQLScalarType.newScalar()\n            .name("email")\n            .description("A custom scalar that handles emails")\n            .coercing(new Coercing() {\n                @Override\n                public Object serialize(Object dataFetcherResult, GraphQLContext graphQLContext, Locale locale) {\n                    return serializeEmail(dataFetcherResult);\n                }\n\n                @Override\n                public Object parseValue(Object input, GraphQLContext graphQLContext, Locale locale) {\n                    return parseEmailFromVariable(input);\n                }\n\n                @Override\n                public Object parseLiteral(Value input, CoercedVariables variables, GraphQLContext graphQLContext, Locale locale) {\n                    return parseEmailFromAstLiteral(input);\n                }\n            })\n            .build();\n\n    private static boolean looksLikeAnEmailAddress(String possibleEmailValue) {\n        // ps.  I am not trying to replicate RFC-3696 clearly\n        return Pattern.matches("[A-Za-z0-9]@[.*]", possibleEmailValue);\n    }\n\n    private static Object serializeEmail(Object dataFetcherResult) {\n        String possibleEmailValue = String.valueOf(dataFetcherResult);\n        if (looksLikeAnEmailAddress(possibleEmailValue)) {\n            return possibleEmailValue;\n        } else {\n            throw new CoercingSerializeException("Unable to serialize " + possibleEmailValue + " as an email address");\n        }\n    }\n\n    private static Object parseEmailFromVariable(Object input) {\n        if (input instanceof String) {\n            String possibleEmailValue = input.toString();\n            if (looksLikeAnEmailAddress(possibleEmailValue)) {\n                return possibleEmailValue;\n            }\n        }\n        throw new CoercingParseValueException("Unable to parse variable value " + input + " as an email address");\n    }\n\n    private static Object parseEmailFromAstLiteral(Object input) {\n        if (input instanceof StringValue) {\n            String possibleEmailValue = ((StringValue) input).getValue();\n            if (looksLikeAnEmailAddress(possibleEmailValue)) {\n                return possibleEmailValue;\n            }\n        }\n        throw new CoercingParseLiteralException(\n                "Value is not any email address : \'" + String.valueOf(input) + "\'"\n        );\n    }\n}\n')))}m.isMDXComponent=!0}}]);